# Лабораторная работа №4
Выполнили Скопецкий Анатолий, Полеся Виталий, б9118-09.03.04прогин

## HTB Backdoor. Easy
* ip 10.10.11.125
* Из интересного на сайте ВМ только пометка об использовании WordPress
![](images/1.png)


* Nessus нашёл только пользователя admin.
![](images/2.png)


* Nessus определил директории на удалённой ВМ. Файловая система сайта соответствует сервису WordPress.
![](images/4.png)


* Здесь должен был быть скриншот файловой системы удалённого сайта. И вот он есть.
![](images/27.png)


* В интернете было найдено средство для сканирования таких сервисов. Вообще это не первый скан, сначала был без токена и он не отображал уязвимости на сайте. Потом был подключен скан плагинов на сайте для "расширения" области поиска уязвимостей.
![](images/5.png)


* Сводка о найденных уязвимостях Nessus-ом и WPScan-ом в самом сервисе WordPress.
![](images/7.png)


* Найдена уязвимость в плагинах. Потенциально что-то более подходящее относительно выявленных уязвимостей в самом WordPress.
![](images/6.png)


* Перешёл по ссылке - ничего.
![](images/8.png)


* Попробовал заглянуть в сам каталог плагинов - дало результат.
![](images/9.png)


* Открыв папку плагина, мы можем открыть readme файл, чтобы посмотреть номер версии плагина. (1.1)
![](images/12.png)


* Произведён поиск уязвимости для данного плагина в exploit-db. Уязвимость найдена.
![](images/13.png)

* Содержимое уязвимости.
![](images/23.png)


### Plugin eBook Download 1.1 - Directory Traversal
* Используем путь, указанный в описании уязвимости, и получаем конфигурационный файл данного расширения. Полезной именно для нас информации он не содержит.
![](images/14.png)


* Попробовал посмотреть содержимое ручки filedownload, ибо странно, что можно вводить путь и он спокойно принимается плагином. На скрине наглядно видно, что для переменной не используется никакая из проверок на безопасность пути. Очевидная ошибка.
![](images/17.png)


* Попробуем пробить список пользователей и их паролей.
![](images/15.png)


* Скачиваем данный файл.
![](images/16.png)


* Получаем только информацию о расположении путей до пользователей системы.
![](images/18.png)


* Попытка получить ключ пользователя с помощью прямого скачивания файла из корневой папки пользователя. Неудачно.
![](images/19.png)


* Краткий итог - используя уязвимости самого API WordPress, мы не сможем получить доступ к аккаунту пользователя. Но про плагин не забываем.

### Переход к новому направлению атаки - порт 1337
![](images/10.png)


* Информация о порте 1337. Потенциальный аналог SSH-порта для некоторых программных средств. Забавное название "LEET"-порт бтв.
![](images/11.png)


* Попробуем прочитать все процессы, что существуют на сервере. Может, поможет определить, зачем порт 1337 существует. Пример вывода информации о процессах на компьютере под linux.
![](images/22.png)


* Проверка у себя на ПК - действительно совпадает. Выберем чтение файлов cmdline - параметры запуска того или иного приложения.
![](images/21.png)


* Запускаем intercept-ора в Burp-е, открывается браузер. Вводим одну из ранее использованных команд, чтбы получить все необходимые header-ы.
![](images/20.png)


* Переносим содержимое header-ов в intruder, редактируем так, чтобы мы брутфорсили названия процессов, указываем диапазон от 100 (чтобы отсечь системные процессы) до 10000 (по сути в бесконечность) и смотрим время от времени результаты (в течение ОГРОМНОГО промежутка времени). Ну и начинаем, соответственно, работу.

* Одним из responce-ов оказался приведённый ниже responce. Он указывает на использование gdbserver-а по порту 1337. Нашли то, что искали.
![](images/24.png)


#### Далее был произведён поиск на сразу же нескольких ресурсах.

* Ресурс 1 - поисковик. Уязвимость есть в базах данных metasploit.
![](images/26.png)

* Ресурс 2 - exploit-db. Python-овский скрипт. У меня не сработал, Витале не предлагал воспользоваться.
![](images/25.png)

### Эксплуатация уязвимости с помощью metasploit
* Неудачная попытка старта при выставлении только параметров rhost/rport.
![](end/msf1.png)
* Проверка локального ip.
![](end/ip_addr.png)
* metasploit. Удачная попытка старта при настройке параметра lhost.
![](end/msf2.png)
* Подключенный listener порта 4444. Общение с удалённой ВМ с помощью bash команд. Здесь можно наблюдать ответ, почему я не смог скачать file.txt из корневой папки пользователя - доступа на чтение данного файла нет ни у кого, кроме самого пользователя.
![](end/msf3.png)
* Флаг пользователя.
![](end/cat.png)
* Результат сабмита флага.
![](end/flag.png)
